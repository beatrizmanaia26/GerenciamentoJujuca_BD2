<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Loja</title>
    <!-- Reaproveite seu CSS base ou crie um específico para a loja -->
    <link rel="stylesheet" th:href="@{/css/cadastrar-funcionario.css}">
    <style>
        /* Ajustes rápidos para a vitrine */
        .toolbar {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }
        .toolbar input[type="search"] {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: #fff;
        }
        .btn {
            display: inline-block;
            text-align: center;
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            border: 1px solid var(--primary);
            background: var(--primary);
            color: #fff;
            transition: background .15s;
        }
        .btn:hover { background: var(--primary-hover); }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        @media (min-width: 720px) {
            .grid { grid-template-columns: repeat(3, 1fr); }
        }
        .product {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px;
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 8px;
            box-shadow: 0 10px 20px rgba(17,24,39,.04);
        }
        .product img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: #fff;
        }
        .product h3 {
            margin: 0;
            font-size: 1.05rem;
        }
        .muted { color: var(--muted); font-size: .9rem; margin: 0; }
        .price { font-weight: 700; }
        .buy {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 6px;
        }
        .buy input[type="number"] {
            width: 88px;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 10px;
        }
    </style>
</head>
<body>
<main class="page">
    <header class="header">
        <div>
            <h2>Loja</h2>
            <p class="hint">Pesquise por nome, marca ou tipo de produto</p>
        </div>
        <nav class="nav">
            <a th:href="@{/area-funcionario}" class="btn" style="background:#fff;color:var(--text);border-color:var(--border);">Área do Funcionário</a>
        </nav>
    </header>

    <section class="card">
        <!-- Barra de pesquisa -->
        <form class="toolbar" th:action="@{/loja}" method="get">
            <input type="search" name="q" placeholder="Buscar produtos..." th:value="${q}">
            <button type="submit" class="btn">Buscar</button>
            <a th:href="@{/loja}" class="btn" style="background:#fff;color:var(--text);border-color:var(--border);">Limpar</a>
        </form>

        <!-- Mensagens via FlashAttributes -->
        <div id="flash-sucesso" th:if="${sucesso}" th:data-msg="${sucesso}" hidden></div>
        <div id="flash-erro"    th:if="${erro}"    th:data-msg="${erro}" hidden></div>

        <!-- Grid de produtos -->
        <div class="grid">
            <div class="product" th:each="p : ${produtos}">
                <!-- Foto do produto (exibe imagem, não a URL) -->
                <img th:if="${p.imagem}" th:src="${p.imagem}" alt="" />
                <div th:if="${p.imagem == null or #strings.isEmpty(p.imagem)}"
                     style="width:100%;height:160px;border:1px dashed var(--border);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--muted);">
                    Sem imagem
                </div>

                <div>
                    <h3 th:text="${p.nome}">Nome do Produto</h3>
                    <p class="muted">
                        <span th:text="'Marca: ' + ${p.marca}">Marca</span>
                        <span th:if="${p.tipoProduto}"> · <span th:text="${p.tipoProduto}">Tipo</span></span>
                    </p>
                    <p class="muted">
                        <span class="price" th:text="'R$ ' + ${#numbers.formatDecimal(p.preco, 1, 'COMMA', 2, 'POINT')}">R$ 0,00</span>
                        <span th:if="${p.unidade}"> · <span th:text="${p.unidade}">un</span></span>
                        <span th:if="${p.quantidade != null}"> · <span th:text="'Estoque: ' + ${p.quantidade}">Estoque</span></span>
                    </p>
                </div>

                <!-- Comprar -->
                <form class="buy" th:action="@{/loja/comprar}" method="post">
                    <input type="hidden" name="productId" th:value="${p.id}">
                    <input type="number" name="quantidade" min="1" step="1" placeholder="Qtd" th:attr="max=${p.quantidade}">
                    <input type="text" name="cpfCliente" placeholder="CPF (opcional)" style="width:130px;">
                    <button type="submit" class="btn">Vender</button>
                </form>

            </div>
        </div>
    </section>
</main>

<script>
    (function () {
        var ok  = document.getElementById('flash-sucesso');
        var err = document.getElementById('flash-erro');
        if (ok)      alert(ok.dataset.msg);
        else if (err) alert(err.dataset.msg);
    })();
</script>
</body>


</html>
